{

    "AWSTemplateFormatVersion": "2010-09-09",

    "Metadata": {

        "AWS::CloudFormation::Designer": {

            "3a8a9c43-f9de-4823-934b-f43c4ac00794": {

                "size": {

                    "width": 60,

                    "height": 60

                },

                "position": {

                    "x": 190,

                    "y": 180

                },

                "z": 0,

                "embeds": [],

                "isassociatedwith": [

                    "e5da0ed8-10e5-44c9-91b6-8877e8ddc4a4",

                    "0472a016-f097-40c0-b999-634a82070bf1"

                ]

            },

            "e5da0ed8-10e5-44c9-91b6-8877e8ddc4a4": {

                "size": {

                    "width": 60,

                    "height": 60

                },

                "position": {

                    "x": 190,

                    "y": 80

                },

                "z": 0,

                "embeds": []

            },

            "0472a016-f097-40c0-b999-634a82070bf1": {

                "size": {

                    "width": 60,

                    "height": 60

                },

                "position": {

                    "x": 370,

                    "y": 80

                },

                "z": 0,

                "embeds": []

            },

            "a95856f3-682d-45e3-9143-23963c153f71": {

                "size": {

                    "width": 60,

                    "height": 60

                },

                "position": {

                    "x": 370,

                    "y": 180

                },

                "z": 0,

                "embeds": [],

                "isassociatedwith": [

                    "e5da0ed8-10e5-44c9-91b6-8877e8ddc4a4",

                    "0472a016-f097-40c0-b999-634a82070bf1"

                ]

            },

            "fbafc535-3321-4630-97ab-954be8e93583": {

                "size": {

                    "width": 60,

                    "height": 60

                },

                "position": {

                    "x": 490,

                    "y": 180

                },

                "z": 0,

                "embeds": [],

                "isassociatedwith": [

                    "e5da0ed8-10e5-44c9-91b6-8877e8ddc4a4",

                    "0472a016-f097-40c0-b999-634a82070bf1"

                ]

            }

        }

    },

    "Resources": {

        "NULLinfra": {

            "Type": "AWS::EC2::SecurityGroup",

            "Properties": {

                "GroupDescription": "allow ports 80, 443, 8085",

                "SecurityGroupIngress": [

                    {

                        "IpProtocol": "tcp",

                        "FromPort": "80",

                        "ToPort": "80",

                        "CidrIp": "0.0.0.0/0"

                    },

                    {

                        "IpProtocol": "tcp",

                        "FromPort": "443",

                        "ToPort": "443",

                        "CidrIp": "0.0.0.0/0"

                    },

                    {

                        "IpProtocol": "tcp",

                        "FromPort": "8085",

                        "ToPort": "8085",

                        "CidrIp": "0.0.0.0/0"

                    }

                ]

            },

            "Metadata": {

                "AWS::CloudFormation::Designer": {

                    "id": "e5da0ed8-10e5-44c9-91b6-8877e8ddc4a4"

                }

            }

        },

        "NULLinfraEC2": {

            "Type": "AWS::EC2::Instance",

            "Properties": {

                "InstanceType": "t2.medium",

                "SecurityGroups": [

                    {

                        "Ref": "NULLinfra"

                    },

                    {

                        "Ref": "NULLsg"

                    }

                ],

                "KeyName": {

                    "Ref": "KeyName"

                },

                "ImageId": "ami-0729e439b6769d6ab"

            },

            "Metadata": {

                "AWS::CloudFormation::Designer": {

                    "id": "3a8a9c43-f9de-4823-934b-f43c4ac00794"

                }

            }

        },

        "NULLsg": {

            "Type": "AWS::EC2::SecurityGroup",

            "Properties": {

                "GroupDescription": "allow ports 22, 8080",

                "SecurityGroupIngress": [

                    {

                        "IpProtocol": "tcp",

                        "FromPort": "22",

                        "ToPort": "22",

                        "CidrIp": "0.0.0.0/0"

                    },

                    {

                        "IpProtocol": "tcp",

                        "FromPort": "8080",

                        "ToPort": "8080",

                        "CidrIp": "0.0.0.0/0"

                    }

                ]

            },

            "Metadata": {

                "AWS::CloudFormation::Designer": {

                    "id": "0472a016-f097-40c0-b999-634a82070bf1"

                }

            }

        },

        "NULLprod": {

            "Type": "AWS::EC2::Instance",

            "Properties": {

                "InstanceType": "t2.micro",

                "SecurityGroups": [

                    {

                        "Ref": "NULLsg"

                    }

                ],

                "KeyName": {

                    "Ref": "KeyName"

                },

                "ImageId": "ami-0729e439b6769d6ab"

            },

            "Metadata": {

                "AWS::CloudFormation::Designer": {

                    "id": "a95856f3-682d-45e3-9143-23963c153f71"

                }

            }

        },

        "NULLstage": {

            "Type": "AWS::EC2::Instance",

            "Properties": {

                "InstanceType": "t2.micro",

                "SecurityGroups": [

                    {

                        "Ref": "NULLsg"

                    }

                ],

                "KeyName": {

                    "Ref": "KeyName"

                },

                "ImageId": "ami-0729e439b6769d6ab"

            },

            "Metadata": {

                "AWS::CloudFormation::Designer": {

                    "id": "fbafc535-3321-4630-97ab-954be8e93583"

                }

            }

        }

    },

    "Parameters": {

        "KeyName": {

            "Description": "Name of an existing EC2 KeyPair to enable SSH access to the instance",

            "Type": "AWS::EC2::KeyPair::KeyName",

            "ConstraintDescription": "must be the name of an existing EC2 KeyPair."

        }

    },

    "Outputs": {

        "infraIP": {

            "Value": {

                "Fn::GetAtt": [

                    "NULLinfraEC2",

                    "PublicIp"

                ]

            }

        },

        "prodIP": {

            "Value": {

                "Fn::GetAtt": [

                    "NULLprod",

                    "PublicIp"

                ]

            }

        },

        "stageIP": {

            "Value": {

                "Fn::GetAtt": [

                    "NULLstage",

                    "PublicIp"

                ]

            }

        }

    }

}
